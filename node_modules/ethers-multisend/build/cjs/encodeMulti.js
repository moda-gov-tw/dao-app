"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.encodeMulti = exports.MULTI_SEND_ABI = void 0;
const abi_1 = require("@ethersproject/abi");
const bytes_1 = require("@ethersproject/bytes");
const solidity_1 = require("@ethersproject/solidity");
const types_1 = require("./types");
exports.MULTI_SEND_ABI = ['function multiSend(bytes memory transactions)'];
const MULTI_SEND_CONTRACT_ADDRESS = '0xA238CBeb142c10Ef7Ad8442C6D1f9E89e07e7761';
/// Encodes the transaction as packed bytes of:
/// - `operation` as a `uint8` with `0` for a `call` or `1` for a `delegatecall` (=> 1 byte),
/// - `to` as an `address` (=> 20 bytes),
/// - `value` as a `uint256` (=> 32 bytes),
/// -  length of `data` as a `uint256` (=> 32 bytes),
/// - `data` as `bytes`.
const encodePacked = (tx) => (0, solidity_1.pack)(['uint8', 'address', 'uint256', 'uint256', 'bytes'], [
    tx.operation || types_1.OperationType.Call,
    tx.to,
    tx.value,
    (0, bytes_1.hexDataLength)(tx.data),
    tx.data,
]);
const remove0x = (hexString) => hexString.substr(2);
// Encodes a batch of module transactions into a single multiSend module transaction.
// A module transaction is an object with fields corresponding to a Gnosis Safe's (i.e., Zodiac IAvatar's) `execTransactionFromModule` method parameters.
// For more information refer to https://docs.gnosis.io/safe/docs/contracts_details/#gnosis-safe-transactions.
const encodeMulti = (transactions, multiSendContractAddress = MULTI_SEND_CONTRACT_ADDRESS) => {
    const transactionsEncoded = '0x' + transactions.map(encodePacked).map(remove0x).join('');
    const multiSendContract = new abi_1.Interface(exports.MULTI_SEND_ABI);
    const data = multiSendContract.encodeFunctionData('multiSend', [
        transactionsEncoded,
    ]);
    return {
        operation: types_1.OperationType.DelegateCall,
        to: multiSendContractAddress || MULTI_SEND_CONTRACT_ADDRESS,
        value: '0x00',
        data,
    };
};
exports.encodeMulti = encodeMulti;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW5jb2RlTXVsdGkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvZW5jb2RlTXVsdGkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsNENBQThDO0FBQzlDLGdEQUFvRDtBQUNwRCxzREFBOEM7QUFFOUMsbUNBQXdEO0FBRTNDLFFBQUEsY0FBYyxHQUFHLENBQUMsK0NBQStDLENBQUMsQ0FBQTtBQUMvRSxNQUFNLDJCQUEyQixHQUFHLDRDQUE0QyxDQUFBO0FBRWhGLCtDQUErQztBQUMvQyw2RkFBNkY7QUFDN0YseUNBQXlDO0FBQ3pDLDJDQUEyQztBQUMzQyxxREFBcUQ7QUFDckQsd0JBQXdCO0FBQ3hCLE1BQU0sWUFBWSxHQUFHLENBQUMsRUFBbUIsRUFBRSxFQUFFLENBQzNDLElBQUEsZUFBSSxFQUNGLENBQUMsT0FBTyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLE9BQU8sQ0FBQyxFQUNuRDtJQUNFLEVBQUUsQ0FBQyxTQUFTLElBQUkscUJBQWEsQ0FBQyxJQUFJO0lBQ2xDLEVBQUUsQ0FBQyxFQUFFO0lBQ0wsRUFBRSxDQUFDLEtBQUs7SUFDUixJQUFBLHFCQUFhLEVBQUMsRUFBRSxDQUFDLElBQUksQ0FBQztJQUN0QixFQUFFLENBQUMsSUFBSTtDQUNSLENBQ0YsQ0FBQTtBQUVILE1BQU0sUUFBUSxHQUFHLENBQUMsU0FBaUIsRUFBRSxFQUFFLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQTtBQUUzRCxxRkFBcUY7QUFDckYseUpBQXlKO0FBQ3pKLDhHQUE4RztBQUN2RyxNQUFNLFdBQVcsR0FBRyxDQUN6QixZQUF3QyxFQUN4QywyQkFBbUMsMkJBQTJCLEVBQzdDLEVBQUU7SUFDbkIsTUFBTSxtQkFBbUIsR0FDdkIsSUFBSSxHQUFHLFlBQVksQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQTtJQUU5RCxNQUFNLGlCQUFpQixHQUFHLElBQUksZUFBUyxDQUFDLHNCQUFjLENBQUMsQ0FBQTtJQUN2RCxNQUFNLElBQUksR0FBRyxpQkFBaUIsQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLEVBQUU7UUFDN0QsbUJBQW1CO0tBQ3BCLENBQUMsQ0FBQTtJQUVGLE9BQU87UUFDTCxTQUFTLEVBQUUscUJBQWEsQ0FBQyxZQUFZO1FBQ3JDLEVBQUUsRUFBRSx3QkFBd0IsSUFBSSwyQkFBMkI7UUFDM0QsS0FBSyxFQUFFLE1BQU07UUFDYixJQUFJO0tBQ0wsQ0FBQTtBQUNILENBQUMsQ0FBQTtBQWxCWSxRQUFBLFdBQVcsZUFrQnZCIn0=